

WSROOT="$(x wsroot)"
update_xcmd_advise()(
    x mkdirp "$WSROOT/tmp"
    if [ -d "$WSROOT/tmp/advise" ]; then
        cd "$WSROOT/tmp/advise" || return
        git stash
        git pull origin main
    else
        cd "$WSROOT/tmp" || return
        git clone git@github.com:x-cmd/advise
    fi
)

f()(
    xws pub
    update_xcmd_advise || return

    x:info "Copy $WSROOT/dist to $WSROOT/tmp/advise"
    cp -r "$WSROOT/dist" "$WSROOT/tmp/advise"
    cd "$WSROOT/tmp/advise" || return
    git add dist/all.tgz
    git commit -m "update: dist/all.tgz"
    xws push
)

f